#!/bin/bash
set -e  # Exit immediately if any command fails

echo "Running formatting..."
git cl format

echo "Staging new files..."
# Add ONLY untracked (new) files
# -z / -0 handles filenames with spaces safely.
# removed -r as it is not supported on macOS default xargs
git ls-files -z --others --exclude-standard | xargs -0 git add

echo "Amending commit..."
# Commit changes
# -a: Automatically stages modified and deleted files (like git add -u).
# Removed --ignore-submodules=all as it is not a valid flag for git commit.
git commit -a --amend --no-edit

echo "Uploading..."
git cl upload -d -T "$@"
